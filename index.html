<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="description" content="ç”°ä¸­å›çš„å´©æºƒæ—¥å¸¸ - æç¬‘æ—¥è¯­è¯æ±‡æŒ‘æˆ˜">
    
    <!-- PWA / Mobile Web App Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#eff6ff">
    <title>ç”°ä¸­å›çš„å´©æºƒæ—¥å¸¸</title>

    <!-- App Icon (Embedded SVG) -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ˜</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22 style=%22background-color: %23fef3c7;%22><rect width=%22100%22 height=%22100%22 fill=%22%23fef3c7%22/><text x=%2250%22 y=%2250%22 font-size=%2270%22 text-anchor=%22middle%22 dy=%22.35em%22>ğŸ˜</text></svg>">

    <style>
        /* --- åŸç”Ÿ CSS é‡ç½®ä¸å˜é‡å®šä¹‰ --- */
        :root {
            --primary: #6366f1; /* Indigo 500 */
            --primary-dark: #4338ca; /* Indigo 700 */
            --primary-light: #e0e7ff; /* Indigo 100 */
            --secondary: #facc15; /* Yellow 400 */
            --bg-start: #eff6ff; /* Blue 50 */
            --bg-end: #e0e7ff; /* Indigo 100 */
            --white: #ffffff;
            --text-main: #1f2937;
            --text-sub: #6b7280;
            --danger: #ef4444;
            --success: #22c55e;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans JP", sans-serif;
            background: linear-gradient(to bottom, var(--bg-start), var(--bg-end));
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            overscroll-behavior: none;
            touch-action: manipulation;
            user-select: none;
            -webkit-user-select: none;
        }

        /* æ¸¸æˆä¸»å®¹å™¨ */
        .game-container {
            width: 100%;
            max-width: 28rem; /* max-w-md */
            background-color: var(--white);
            border-radius: 1.5rem; /* rounded-3xl */
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            border: 4px solid #c7d2fe; /* Indigo 200 */
            display: flex;
            flex-direction: column;
            height: 100%;
            max-height: 90%;
            position: relative;
            overflow: hidden;
        }

        /* é¡¶éƒ¨ Header */
        .header {
            background-color: var(--primary);
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: var(--white);
            flex-shrink: 0;
            z-index: 10;
        }

        .score-box {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .score-text {
            font-weight: 700;
            font-size: 1.25rem;
        }

        .progress-track {
            flex: 1;
            margin: 0 1rem;
            background-color: var(--primary-dark);
            border-radius: 9999px;
            height: 0.75rem;
        }

        .progress-bar {
            background-color: var(--secondary);
            height: 100%;
            border-radius: 9999px;
            width: 0%;
            transition: width 0.5s ease-out;
        }

        .level-badge {
            font-weight: 700;
            font-size: 0.875rem;
        }

        /* å¯æ»šåŠ¨å†…å®¹åŒº */
        .content-area {
            padding: 1.5rem;
            position: relative;
            flex: 1;
            overflow-y: auto;
        }
        
        /* éšè—æ»šåŠ¨æ¡ */
        .content-area::-webkit-scrollbar {
            display: none;
        }

        /* ç”°ä¸­å›å¤´åƒ */
        .avatar-section {
            display: flex;
            justify-content: center;
            margin-bottom: 1rem;
        }

        .avatar-wrapper {
            position: relative;
        }

        .avatar-face {
            width: 5rem;
            height: 5rem;
            background-color: #fef9c3; /* Yellow 100 */
            border-radius: 9999px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            border: 2px solid #fde68a; /* Yellow 200 */
            box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease;
        }

        .avatar-status {
            position: absolute;
            top: -0.5rem;
            right: -3rem;
            background-color: var(--white);
            padding: 0.25rem 0.75rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid #f3f4f6;
            font-size: 0.75rem;
            color: var(--text-sub);
            white-space: nowrap;
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .7; }
        }

        /* é—®é¢˜åœºæ™¯æ¡† */
        .scenario-box {
            margin-bottom: 1rem;
            text-align: center;
        }

        .scenario-label {
            color: #9ca3af;
            font-size: 0.75rem;
            margin-bottom: 0.25rem;
            letter-spacing: 0.1em;
            font-family: "Arial", sans-serif;
            font-weight: bold;
        }

        .scenario-content {
            background-color: #f9fafb;
            padding: 1rem;
            border-radius: 0.75rem;
            border: 1px solid #f3f4f6;
            min-height: 90px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .scenario-text {
            font-size: 1rem;
            color: var(--text-main);
            line-height: 1.625;
            font-weight: 500;
        }
        
        .highlight-blank {
            border-bottom: 2px solid #818cf8;
            color: #6366f1;
            font-weight: bold;
            padding: 0 0.25rem;
            display: inline-block;
        }

        /* é€‰é¡¹æŒ‰é’® */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.75rem;
            padding-bottom: 1rem;
        }

        .option-btn {
            width: 100%;
            background-color: var(--white);
            border: 2px solid var(--primary-light);
            padding: 1rem;
            border-radius: 1rem;
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--text-main);
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            transition: all 0.15s ease;
            position: relative;
            overflow: hidden;
            cursor: pointer;
            -webkit-appearance: none; /* remove iOS default btn style */
        }

        .option-btn:active {
            transform: scale(0.96);
            background-color: var(--primary-light);
        }

        /* æ¨¡æ€æ¡†é€šç”¨ */
        .modal-overlay {
            position: fixed;
            inset: 0;
            z-index: 50;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            background-color: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
        }

        .modal-card {
            background-color: var(--white);
            width: 100%;
            max-width: 24rem;
            border-radius: 1.5rem;
            padding: 1.5rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            text-align: center;
            border: 4px solid var(--white);
            transform: scale(1);
            transition: all 0.3s ease;
        }
        
        /* éšè—å·¥å…·ç±» */
        .hidden {
            display: none !important;
        }

        /* ç»“æœæ¨¡æ€æ¡†å†…å®¹ */
        .modal-icon {
            font-size: 3.75rem;
            margin-bottom: 1rem;
        }
        
        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .modal-title.correct { color: var(--success); }
        .modal-title.wrong { color: var(--danger); }

        .word-detail-box {
            background-color: var(--bg-start);
            padding: 1rem;
            border-radius: 0.75rem;
            text-align: left;
            margin-bottom: 1rem;
            box-shadow: inset 0 2px 4px 0 rgba(0,0,0,0.05);
        }

        .word-header {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: 0.25rem;
        }

        .word-text {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-dark);
        }

        .reading-text {
            font-size: 0.875rem;
            color: var(--primary);
            font-family: monospace;
        }

        .meaning-label {
            font-size: 0.75rem;
            color: #9ca3af;
            text-transform: uppercase;
            border-top: 1px solid #c7d2fe;
            padding-top: 0.25rem;
            margin-top: 0.25rem;
        }

        .meaning-text {
            color: var(--text-main);
            font-weight: 500;
        }

        .funny-comment {
            font-size: 0.875rem;
            color: var(--text-sub);
            font-style: italic;
            margin-bottom: 1.5rem;
        }

        .action-btn {
            width: 100%;
            background-color: var(--primary);
            color: var(--white);
            font-weight: 700;
            padding: 0.75rem 1.5rem;
            border-radius: 1rem;
            border: none;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transition: transform 0.1s;
            font-size: 1rem;
            cursor: pointer;
        }

        .action-btn:active {
            transform: scale(0.95);
        }

        /* Game Over æ¨¡æ€æ¡† */
        .game-over-bg {
            background-color: var(--primary-dark);
            color: var(--white);
            flex-direction: column;
        }

        .score-large {
            font-size: 3.75rem;
            font-weight: 700;
            color: var(--secondary);
            margin-bottom: 0.5rem;
        }

        .retry-btn {
            background-color: var(--secondary);
            color: var(--primary-dark);
            margin-top: 0.75rem;
        }
        
        .share-btn {
            background-color: var(--white);
            color: var(--primary);
        }

        .hint-text {
            margin-top: 1rem;
            color: var(--primary);
            font-size: 0.75rem;
            text-align: center;
            opacity: 0.7;
        }

        /* åŠ¨ç”» */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        .shake {
            animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both;
        }

        @keyframes bounce-in {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.05); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        .pop-in {
            animation: bounce-in 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }
    </style>
</head>
<body>

    <!-- Game Container -->
    <div class="game-container">
        
        <!-- Header -->
        <div class="header">
            <div class="score-box">
                <span style="font-size: 1.5rem;">ğŸ†</span>
                <span id="scoreDisplay" class="score-text">0</span>
            </div>
            <div class="progress-track">
                <div id="progressBar" class="progress-bar"></div>
            </div>
            <div class="level-badge">Lv.<span id="levelDisplay">N3</span></div>
        </div>

        <!-- Scrollable Content Area -->
        <div class="content-area">
            
            <!-- Tanaka Avatar -->
            <div class="avatar-section">
                <div class="avatar-wrapper">
                    <div class="avatar-face" id="tanakaFace">
                        ğŸ˜
                    </div>
                    <div class="avatar-status" id="statusText">
                        æ­£åœ¨å‘å‘†...
                    </div>
                </div>
            </div>

            <!-- Question Scenario -->
            <div class="scenario-box">
                <p class="scenario-label">SCENARIO / åœºæ™¯</p>
                <div class="scenario-content">
                    <p id="questionText" class="scenario-text">
                        åŠ è½½ä¸­...
                    </p>
                </div>
            </div>

            <!-- Options Grid -->
            <div id="optionsGrid" class="options-grid">
                <!-- Options injected here -->
            </div>
        </div>
    </div>

    <!-- Share/Install Hint -->
    <div class="hint-text">
        <p>ğŸ’¡ Tip: åœ¨æµè§ˆå™¨èœå•ä¸­é€‰æ‹©â€œæ·»åŠ åˆ°ä¸»å±å¹•â€ä½“éªŒæ›´ä½³</p>
    </div>

    <!-- Feedback Modal -->
    <div id="feedbackPanel" class="modal-overlay hidden">
        <div class="modal-card">
            <div id="feedbackIcon" class="modal-icon">ğŸ‰</div>
            <h2 id="feedbackTitle" class="modal-title">æ­£è§£ï¼</h2>
            
            <div class="word-detail-box">
                <div class="word-header">
                    <p id="resultWord" class="word-text">å˜èª</p>
                    <p id="resultReading" class="reading-text">ãŸã‚“ã”</p>
                </div>
                <p class="meaning-label">Meaning</p>
                <p id="resultMeaning" class="meaning-text">å«ä¹‰</p>
            </div>

            <p id="funnyComment" class="funny-comment">"ç”°ä¸­å›è§‰å¾—å¾ˆèµã€‚"</p>

            <button onclick="nextQuestion()" class="action-btn">
                ä¸‹ä¸€é¢˜ (Tsugi!)
            </button>
        </div>
    </div>

    <!-- Game Over Modal -->
    <div id="gameOverPanel" class="modal-overlay game-over-bg hidden">
        <div style="font-size: 3.75rem; margin-bottom: 1rem; animation: bounce 1s infinite;">ğŸ±</div>
        <h2 style="font-size: 1.875rem; font-weight: 700; margin-bottom: 0.5rem;">ä¸‹ç­å•¦ï¼</h2>
        <p style="color: #c7d2fe; margin-bottom: 1.5rem;">ä»Šå¤©çš„æ—¥è¯­ä¿®ç‚¼æˆæœ...</p>
        <div id="finalScore" class="score-large">0</div>
        <p id="finalRank" style="font-size: 1.125rem; color: #a5b4fc; margin-bottom: 2rem;">èœé¸Ÿç¤¾ç•œ</p>
        
        <div style="display: flex; flex-direction: column; width: 100%; max-width: 20rem; gap: 0.75rem;">
            <button onclick="shareScore()" id="shareBtn" class="action-btn share-btn hidden">
                ç‚«è€€ä¸€ä¸‹ (Share)
            </button>
            <button onclick="restartGame()" class="action-btn retry-btn">
                å†æ¥ä¸€å¤© (Retry)
            </button>
        </div>
    </div>

    <!-- Confetti Canvas -->
    <canvas id="confetti" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 100;" class="hidden"></canvas>

    <script>
        // --- æ¸¸æˆæ•°æ® (20ä¸ªè¯æ±‡) ---
        const vocabularyData = [
            {
                word: "æˆ‘æ…¢", reading: "ãŒã¾ã‚“ (Gaman)", level: "N3",
                meaning: "å¿è€ï¼Œå¿å—",
                scenario: "ç”µæ¢¯é‡Œåªæœ‰æˆ‘å’Œè€æ¿ä¸¤ä¸ªäººï¼Œçªç„¶æ„Ÿè§‰åˆ°ä¸€é˜µå¼ºçƒˆçš„è…¹ç—›ï¼Œä½†æˆ‘å¿…é¡»______ã€‚",
                fullSentence: "ç”µæ¢¯é‡Œåªæœ‰æˆ‘å’Œè€æ¿ä¸¤ä¸ªäººï¼Œçªç„¶æ„Ÿè§‰åˆ°ä¸€é˜µå¼ºçƒˆçš„è…¹ç—›ï¼Œä½†æˆ‘å¿…é¡»<span class='highlight-blank'>æˆ‘æ…¢</span>ã€‚",
                options: ["æˆ‘æ…¢", "è‡ªæ…¢", "æ€ æ…¢", "è‚¥æº€"],
                comment: "è¿™å°±æ˜¯ç¤¾ç•œçš„ç©¶æå¥¥ä¹‰ï¼å±å¦‚æœä¸å¿ä½ï¼Œäººç”Ÿå°±ç»“æŸäº†ã€‚",
                emotion: "ğŸ˜–"
            },
            {
                word: "çŸ›ç›¾", reading: "ã‚€ã˜ã‚…ã‚“ (Mujun)", level: "N2",
                meaning: "çŸ›ç›¾",
                scenario: "ä¸€è¾¹è¯´ç€â€œæˆ‘è¦å‡è‚¥â€ï¼Œä¸€è¾¹å¾€å˜´é‡Œå¡ç¬¬ä¸‰å—è›‹ç³•ï¼Œè¿™ç§è¡Œä¸ºå……æ»¡äº†______ã€‚",
                fullSentence: "ä¸€è¾¹è¯´ç€â€œæˆ‘è¦å‡è‚¥â€ï¼Œä¸€è¾¹å¾€å˜´é‡Œå¡ç¬¬ä¸‰å—è›‹ç³•ï¼Œè¿™ç§è¡Œä¸ºå……æ»¡äº†<span class='highlight-blank'>çŸ›ç›¾</span>ã€‚",
                options: ["çŸ›ç›¾", "åˆ‡æ–­", "æ²¹æ–­", "æ±ºæ–­"],
                comment: "æ²¡é”™ï¼Œç”œé£Ÿæ˜¯è£…åœ¨å¦ä¸€ä¸ªèƒƒé‡Œçš„ï¼Œè¿™ä¸ç®—çŸ›ç›¾ï¼ˆç¡®ä¿¡ï¼‰ã€‚",
                emotion: "ğŸ°"
            },
            {
                word: "é…æ…®", reading: "ã¯ã„ã‚Šã‚‡ (Hairyo)", level: "N2",
                meaning: "å…³æ€€ï¼Œç…§é¡¾",
                scenario: "çœ‹åˆ°ç§ƒå¤´çš„è¯¾é•¿èµ°è¿‡æ¥ï¼Œç”°ä¸­å›é»˜é»˜åœ°æŠŠå±å¹•ä¸Šçš„å‡å‘å¹¿å‘Šå…³æ‰ï¼Œè¿™æ˜¯ä¸€ç§______ã€‚",
                fullSentence: "çœ‹åˆ°ç§ƒå¤´çš„è¯¾é•¿èµ°è¿‡æ¥ï¼Œç”°ä¸­å›é»˜é»˜åœ°æŠŠå±å¹•ä¸Šçš„å‡å‘å¹¿å‘Šå…³æ‰ï¼Œè¿™æ˜¯ä¸€ç§<span class='highlight-blank'>é…æ…®</span>ã€‚",
                options: ["é…æ…®", "é æ…®", "ç„¦è™‘", "ç„¡ç¤¼"],
                comment: "è¿™æ˜¯ä¸ºäº†å®ˆæŠ¤è¯¾é•¿æœ€åçš„å°Šä¸¥ï¼ŒçœŸæ˜¯æ¸©æŸ”çš„ä¸–ç•Œå•Šã€‚",
                emotion: "ğŸ¤«"
            },
            {
                word: "èºŠèº‡", reading: "ã¡ã‚…ã†ã¡ã‚‡ (Chuucho)", level: "N1",
                meaning: "è¸Œèº‡ï¼ŒçŠ¹è±«",
                scenario: "çœ‹ç€è´­ç‰©è½¦é‡Œé«˜è¾¾3ä¸‡æ—¥å…ƒçš„æ‰‹åŠï¼Œæ‰‹æŒ‡æ”¾åœ¨æ”¯ä»˜æŒ‰é’®ä¸Šï¼Œç”°ä¸­å›æ„Ÿåˆ°äº†å¼ºçƒˆçš„______ã€‚",
                fullSentence: "çœ‹ç€è´­ç‰©è½¦é‡Œé«˜è¾¾3ä¸‡æ—¥å…ƒçš„æ‰‹åŠï¼Œæ‰‹æŒ‡æ”¾åœ¨æ”¯ä»˜æŒ‰é’®ä¸Šï¼Œç”°ä¸­å›æ„Ÿåˆ°äº†å¼ºçƒˆçš„<span class='highlight-blank'>èºŠèº‡</span>ã€‚",
                options: ["èºŠèº‡", "è†¨å¼µ", "ä¸­å‚·", "é‡å®"],
                comment: "ä¹°å§ï¼é’±å¹¶æ²¡æœ‰æ¶ˆå¤±ï¼Œåªæ˜¯å˜æˆäº†ä½ å–œæ¬¢çš„å½¢çŠ¶ï¼",
                emotion: "ğŸ’¸"
            },
            {
                word: "èª¤é­”åŒ–ã™", reading: "ã”ã¾ã‹ã™ (Gomakasu)", level: "N2",
                meaning: "æ•·è¡ï¼Œè’™æ··è¿‡å…³",
                scenario: "å¼€ä¼šè¢«ç‚¹åæ—¶å®Œå…¨æ²¡åœ¨å¬ï¼Œç”°ä¸­å›è¯•å›¾ç”¨â€œæˆ‘ä¹Ÿè¿™ä¹ˆè§‰å¾—â€æ¥______ã€‚",
                fullSentence: "å¼€ä¼šè¢«ç‚¹åæ—¶å®Œå…¨æ²¡åœ¨å¬ï¼Œç”°ä¸­å›è¯•å›¾ç”¨â€œæˆ‘ä¹Ÿè¿™ä¹ˆè§‰å¾—â€æ¥<span class='highlight-blank'>èª¤é­”åŒ–ã™</span>ã€‚",
                options: ["èª¤é­”åŒ–ã™", "æº¶ã‹ã™", "æ€¥ã‹ã™", "å†·ã‚„ã‹ã™"],
                comment: "åªè¦è¡¨æƒ…å¤Ÿè‡ªä¿¡ï¼Œè€æ¿å°±çœ‹ä¸å‡ºä½ åœ¨æ‘¸é±¼ã€‚",
                emotion: "ğŸ¤”"
            },
            {
                word: "ä¸ç”²æ–ãªã„", reading: "ãµãŒã„ãªã„ (Fugainai)", level: "N1",
                meaning: "çªå›Šï¼Œæ²¡å‡ºæ¯",
                scenario: "æœ¬æ¥æƒ³å¸…æ°”åœ°å£å’šï¼Œç»“æœè„šæ»‘æ‘”äº†ä¸ªç‹—åƒå±ï¼ŒçœŸæ˜¯å¤ª______äº†ã€‚",
                fullSentence: "æœ¬æ¥æƒ³å¸…æ°”åœ°å£å’šï¼Œç»“æœè„šæ»‘æ‘”äº†ä¸ªç‹—åƒå±ï¼ŒçœŸæ˜¯å¤ª<span class='highlight-blank'>ä¸ç”²æ–ãªã„</span>äº†ã€‚",
                options: ["ä¸ç”²æ–ãªã„", "å±ãªã„", "ä»•æ–¹ãªã„", "ä»–æ„›ãªã„"],
                comment: "è¿åœ°å¿ƒå¼•åŠ›éƒ½åœ¨é’ˆå¯¹ç”°ä¸­å›ã€‚",
                emotion: "ğŸ¤•"
            },
            {
                word: "å…«ã¤å½“ãŸã‚Š", reading: "ã‚„ã¤ã‚ãŸã‚Š (Yatsuatari)", level: "N1",
                meaning: "ä¹±å‘è„¾æ°”ï¼Œè¿æ€’",
                scenario: "è¢«ä¸Šå¸éª‚äº†ä¹‹åï¼Œç”°ä¸­å›å›å®¶å¯¹ç€æ— è¾œçš„çŒ«å’ªè¿›è¡Œ______ï¼Œç»“æœè¢«çŒ«æŠ“äº†ã€‚",
                fullSentence: "è¢«ä¸Šå¸éª‚äº†ä¹‹åï¼Œç”°ä¸­å›å›å®¶å¯¹ç€æ— è¾œçš„çŒ«å’ªè¿›è¡Œ<span class='highlight-blank'>å…«ã¤å½“ãŸã‚Š</span>ï¼Œç»“æœè¢«çŒ«æŠ“äº†ã€‚",
                options: ["å…«ã¤å½“ãŸã‚Š", "äººå½“ãŸã‚Š", "æ—¥å½“ãŸã‚Š", "ä½“å½“ãŸã‚Š"],
                comment: "çŒ«ï¼šè¿™å°±æ˜¯é£Ÿç‰©é“¾çš„é¡¶ç«¯ï¼ˆçŒ« > ç”°ä¸­ï¼‰ã€‚",
                emotion: "ğŸ˜¾"
            },
            {
                word: "ç©ºæ°—ã‚’èª­ã‚€", reading: "ãã†ãã‚’ã‚ˆã‚€ (Kuuki wo yomu)", level: "N3",
                meaning: "å¯Ÿè¨€è§‚è‰²",
                scenario: "å¤§å®¶éƒ½è¯´â€œä¸æƒ³å»é…’ä¼šâ€ï¼Œåªæœ‰ç”°ä¸­å¤§å–Šâ€œæˆ‘æƒ³å»ï¼â€ï¼Œä»–å®Œå…¨ä¸ä¼š______ã€‚",
                fullSentence: "å¤§å®¶éƒ½è¯´â€œä¸æƒ³å»é…’ä¼šâ€ï¼Œåªæœ‰ç”°ä¸­å¤§å–Šâ€œæˆ‘æƒ³å»ï¼â€ï¼Œä»–å®Œå…¨ä¸ä¼š<span class='highlight-blank'>ç©ºæ°—ã‚’èª­ã‚€</span>ã€‚",
                options: ["ç©ºæ°—ã‚’èª­ã‚€", "ç©ºæ°—ã‚’å¸ã†", "ç©ºæ°—ã‚’å…¥ã‚Œã‚‹", "ç©ºæ°—ã«ã™ã‚‹"],
                comment: "è¿™ç§æ—¶å€™åªè¦ä¿æŒå°´å°¬è€Œä¸å¤±ç¤¼è²Œçš„å¾®ç¬‘å°±å¥½äº†ã€‚",
                emotion: "ğŸ˜¶"
            },
            {
                word: "ææƒš", reading: "ã“ã†ã“ã¤ (Koukotsu)", level: "N1",
                meaning: "ææƒšï¼Œé™¶é†‰",
                scenario: "ç»ˆäºåƒåˆ°äº†æ’é˜Ÿä¸‰å°æ—¶çš„é™é‡æ‹‰é¢ï¼Œç”°ä¸­å›éœ²å‡ºäº†ä¸€è„¸______çš„è¡¨æƒ…ã€‚",
                fullSentence: "ç»ˆäºåƒåˆ°äº†æ’é˜Ÿä¸‰å°æ—¶çš„é™é‡æ‹‰é¢ï¼Œç”°ä¸­å›éœ²å‡ºäº†ä¸€è„¸<span class='highlight-blank'>ææƒš</span>çš„è¡¨æƒ…ã€‚",
                options: ["ææƒš", "æç¸®", "å­¤ç‹¬", "æ˜†è™«"],
                comment: "ç¢³æ°´åŒ–åˆç‰©æ˜¯äººç±»å¿«ä¹çš„æºæ³‰ã€‚",
                emotion: "ğŸœ"
            },
            {
                word: "ä¿®ç¾…å ´", reading: "ã—ã‚…ã‚‰ã° (Shuraba)", level: "N1",
                meaning: "æƒ¨çƒˆçš„åœºé¢/ä¿®ç½—åœº",
                scenario: "å‰å¥³å‹å’Œç°å¥³å‹åœ¨å…¬å¸æ¥¼ä¸‹ç›¸é‡äº†ï¼Œè¿™ç®€ç›´æ˜¯åœ°ç‹±èˆ¬çš„______ï¼",
                fullSentence: "å‰å¥³å‹å’Œç°å¥³å‹åœ¨å…¬å¸æ¥¼ä¸‹ç›¸é‡äº†ï¼Œè¿™ç®€ç›´æ˜¯åœ°ç‹±èˆ¬çš„<span class='highlight-blank'>ä¿®ç¾…å ´</span>ï¼",
                options: ["ä¿®ç¾…å ´", "åŠ‡å ´", "ç‰§å ´", "åºƒå ´"],
                comment: "ç”°ä¸­å›ï¼Œè¯·å®‰æ¯å§ã€‚",
                emotion: "ğŸ˜±"
            },
            {
                word: "ç¾å®Ÿé€ƒé¿", reading: "ã’ã‚“ã˜ã¤ã¨ã†ã² (Genjitsu Touhi)", level: "N1",
                meaning: "é€ƒé¿ç°å®",
                scenario: "æ˜æ˜æ˜å¤©å°±æ˜¯æˆªæ­¢æ—¥æœŸï¼Œç”°ä¸­å›å´å¼€å§‹ç–¯ç‹‚æ‰“æ‰«æˆ¿é—´ï¼Œè¿™å®Œå…¨æ˜¯______ã€‚",
                fullSentence: "æ˜æ˜æ˜å¤©å°±æ˜¯æˆªæ­¢æ—¥æœŸï¼Œç”°ä¸­å›å´å¼€å§‹ç–¯ç‹‚æ‰“æ‰«æˆ¿é—´ï¼Œè¿™å®Œå…¨æ˜¯<span class='highlight-blank'>ç¾å®Ÿé€ƒé¿</span>ã€‚",
                options: ["ç¾å®Ÿé€ƒé¿", "ç¾çŠ¶ç¶­æŒ", "çœŸå‰£å‹è² ", "èˆˆå‘³æ´¥ã€…"],
                comment: "ä¸ºä»€ä¹ˆè€ƒè¯•å‰çš„æ¡Œå­æ€»æ˜¯ç‰¹åˆ«è„ï¼Ÿè¿™æ˜¯å®‡å®™çš„æœªè§£ä¹‹è°œã€‚",
                emotion: "ğŸ§¹"
            },
            {
                word: "ç†ä¸å°½", reading: "ã‚Šãµã˜ã‚“ (Ribujin)", level: "N1",
                meaning: "ä¸è®²ç†ï¼Œè›®æ¨ª",
                scenario: "å®¢æˆ·è¯´â€œè™½ç„¶æ˜¯æˆ‘ç¡®è®¤è¿‡çš„æ–¹æ¡ˆï¼Œä½†æˆ‘ä¸å–œæ¬¢ï¼Œé‡åšâ€ï¼Œè¿™ä¸ªè¦æ±‚å¤ª______äº†ï¼",
                fullSentence: "å®¢æˆ·è¯´â€œè™½ç„¶æ˜¯æˆ‘ç¡®è®¤è¿‡çš„æ–¹æ¡ˆï¼Œä½†æˆ‘ä¸å–œæ¬¢ï¼Œé‡åšâ€ï¼Œè¿™ä¸ªè¦æ±‚å¤ª<span class='highlight-blank'>ç†ä¸å°½</span>äº†ï¼",
                options: ["ç†ä¸å°½", "ä¸è‡ªç„¶", "ä¸ç”¨å¿ƒ", "ä¸å™¨ç”¨"],
                comment: "ç”²æ–¹è™æˆ‘åƒç™¾éï¼Œæˆ‘å¾…ç”²æ–¹å¦‚åˆæ‹ï¼ˆå¹¶ä¸ï¼‰ã€‚",
                emotion: "ğŸ’¢"
            },
            {
                word: "æç¸®", reading: "ãã‚‡ã†ã—ã‚…ã (Kyoushuku)", level: "N2",
                meaning: "æƒ¶æï¼Œè¿‡æ„ä¸å»",
                scenario: "å¤§å®¶éƒ½åœ¨åŠ ç­ï¼Œç”°ä¸­å›å´ä¸å¾—ä¸å‡†æ—¶ä¸‹ç­å»çœ‹ç‰™åŒ»ï¼Œæ„Ÿåˆ°éå¸¸______ã€‚",
                fullSentence: "å¤§å®¶éƒ½åœ¨åŠ ç­ï¼Œç”°ä¸­å›å´ä¸å¾—ä¸å‡†æ—¶ä¸‹ç­å»çœ‹ç‰™åŒ»ï¼Œæ„Ÿåˆ°éå¸¸<span class='highlight-blank'>æç¸®</span>ã€‚",
                options: ["æç¸®", "çŸ­ç¸®", "æ¿ƒç¸®", "çµæŸ"],
                comment: "è™½ç„¶å˜´ä¸Šè¯´â€œä¸å¥½æ„æ€å…ˆèµ°äº†â€ï¼Œå…¶å®å¿ƒé‡Œä¹å¼€äº†èŠ±ã€‚",
                emotion: "ğŸ™‡"
            },
            {
                word: "å°ç„¡ã—", reading: "ã ã„ãªã— (Dainashi)", level: "N3",
                meaning: "ç³Ÿè¹‹ï¼Œç™½è´¹",
                scenario: "ç‰¹æ„ç©¿äº†æ–°ä¹°çš„ç™½è¡¬è¡«ï¼Œç»“æœåƒå’–å–±ä¹Œå†¬é¢æº…åˆ°äº†æ±ï¼Œä¸€å¤©çš„å¿ƒæƒ…éƒ½______äº†ã€‚",
                fullSentence: "ç‰¹æ„ç©¿äº†æ–°ä¹°çš„ç™½è¡¬è¡«ï¼Œç»“æœåƒå’–å–±ä¹Œå†¬é¢æº…åˆ°äº†æ±ï¼Œä¸€å¤©çš„å¿ƒæƒ…éƒ½<span class='highlight-blank'>å°ç„¡ã—</span>äº†ã€‚",
                options: ["å°ç„¡ã—", "æ‰‹æ”¾ã—", "æ–‡ç„¡ã—", "èƒ½ç„¡ã—"],
                comment: "ç™½è¡¬è¡«å¯¹å’–å–±æœ‰ä¸€ç§ç¥ç§˜çš„ä¸‡æœ‰å¼•åŠ›ã€‚",
                emotion: "ğŸ›"
            },
            {
                word: "æ„šç—´", reading: "ãã¡ (Guchi)", level: "N2",
                meaning: "ç‰¢éªšï¼ŒæŠ±æ€¨",
                scenario: "åœ¨å±…é…’å±‹é‡Œï¼Œç”°ä¸­å›å–äº†ä¸€å£å•¤é…’ï¼Œå¼€å§‹å¯¹åŒäº‹å‘æ³„å…³äºè€æ¿çš„______ã€‚",
                fullSentence: "åœ¨å±…é…’å±‹é‡Œï¼Œç”°ä¸­å›å–äº†ä¸€å£å•¤é…’ï¼Œå¼€å§‹å¯¹åŒäº‹å‘æ³„å…³äºè€æ¿çš„<span class='highlight-blank'>æ„šç—´</span>ã€‚",
                options: ["æ„šç—´", "éŸ³ç—´", "ç„¡çŸ¥", "æ©Ÿæ™º"],
                comment: "è¿™å°±æ˜¯æ‰€è°“çš„â€œé…’ç²¾æ¶ˆæ¯’â€ï¼Œæ¶ˆæ¯’å¿ƒçµçš„åˆ›ä¼¤ã€‚",
                emotion: "ğŸº"
            },
            {
                word: "ä½™è¨ˆ", reading: "ã‚ˆã‘ã„ (Yokei)", level: "N3",
                meaning: "å¤šä½™çš„ï¼Œæ— è°“çš„",
                scenario: "æœ¬æ¥ä¸æƒ³åŠ ç­çš„ï¼Œç»“æœçƒ­å¿ƒçš„åŒäº‹å¸®å¿™æŒ‡å‡ºäº†æ›´å¤šBugï¼ŒçœŸæ˜¯åšäº†______çš„äº‹ï¼",
                fullSentence: "æœ¬æ¥ä¸æƒ³åŠ ç­çš„ï¼Œç»“æœçƒ­å¿ƒçš„åŒäº‹å¸®å¿™æŒ‡å‡ºäº†æ›´å¤šBugï¼ŒçœŸæ˜¯åšäº†<span class='highlight-blank'>ä½™è¨ˆ</span>çš„äº‹ï¼",
                options: ["ä½™è¨ˆ", "ä¼šè¨ˆ", "ç”Ÿè¨ˆ", "æ™‚è¨ˆ"],
                comment: "æœ‰æ—¶å€™ï¼Œâ€œä»€ä¹ˆéƒ½ä¸åšâ€å°±æ˜¯æœ€å¤§çš„å¸®å¿™ã€‚",
                emotion: "ğŸ˜«"
            },
            {
                word: "æ®ºé¢¨æ™¯", reading: "ã•ã£ã·ã†ã‘ã„ (Sappuukei)", level: "N1",
                meaning: "å¤§ç…é£æ™¯ï¼Œå•è°ƒä¹å‘³",
                scenario: "æ‰“å¼€ç”°ä¸­å›çš„å‡æœŸæ—¥å†ï¼Œå‘ç°é‡Œé¢ä¸€ç‰‡ç©ºç™½ï¼ŒçœŸæ˜¯å¤ª______äº†ã€‚",
                fullSentence: "æ‰“å¼€ç”°ä¸­å›çš„å‡æœŸæ—¥å†ï¼Œå‘ç°é‡Œé¢ä¸€ç‰‡ç©ºç™½ï¼ŒçœŸæ˜¯å¤ª<span class='highlight-blank'>æ®ºé¢¨æ™¯</span>äº†ã€‚",
                options: ["æ®ºé¢¨æ™¯", "ç™¾é¢ç›¸", "è‡´å‘½å‚·", "ç„¡æ„›æƒ³"],
                comment: "è¿™å°±æ˜¯æç®€ä¸»ä¹‰ç”Ÿæ´»ï¼ˆå¹¶ä¸æ˜¯ï¼Œåªæ˜¯æ²¡æœ‹å‹ï¼‰ã€‚",
                emotion: "ğŸ“…"
            },
            {
                word: "ãŠä¸–è¾", reading: "ãŠã›ã˜ (Oseji)", level: "N3",
                meaning: "å¥‰æ‰¿è¯",
                scenario: "ä¸ºäº†èƒ½åœ¨å…¬å¸ç”Ÿå­˜ä¸‹å»ï¼Œå³ä½¿è€æ¿çš„é¢†å¸¦å¾ˆä¸‘ï¼Œä¹Ÿè¦è¯´â€œçœŸæ—¶å°šå•Šâ€è¿™ç§______ã€‚",
                fullSentence: "ä¸ºäº†èƒ½åœ¨å…¬å¸ç”Ÿå­˜ä¸‹å»ï¼Œå³ä½¿è€æ¿çš„é¢†å¸¦å¾ˆä¸‘ï¼Œä¹Ÿè¦è¯´â€œçœŸæ—¶å°šå•Šâ€è¿™ç§<span class='highlight-blank'>ãŠä¸–è¾</span>ã€‚",
                options: ["ãŠä¸–è¾", "å®¶äº‹", "ç«äº‹", "å¤§äº‹"],
                comment: "è¿™ä¸æ˜¯è°è¨€ï¼Œè¿™æ˜¯èŒåœºæ¶¦æ»‘æ²¹ã€‚",
                emotion: "ğŸ‘”"
            },
            {
                word: "æ”¯é›¢æ»…è£‚", reading: "ã—ã‚Šã‚ã¤ã‚Œã¤ (Shirimetsuretsu)", level: "N1",
                meaning: "è¯­æ— ä¼¦æ¬¡",
                scenario: "é€šå®µå·¥ä½œåï¼Œç”°ä¸­å›çš„æ™¨ä¼šå‘è¨€å‰è¨€ä¸æ­åè¯­ï¼Œå®Œå…¨æ˜¯______ã€‚",
                fullSentence: "é€šå®µå·¥ä½œåï¼Œç”°ä¸­å›çš„æ™¨ä¼šå‘è¨€å‰è¨€ä¸æ­åè¯­ï¼Œå®Œå…¨æ˜¯<span class='highlight-blank'>æ”¯é›¢æ»…è£‚</span>ã€‚",
                options: ["æ”¯é›¢æ»…è£‚", "èª å¿ƒèª æ„", "äº”é‡Œéœ§ä¸­", "å››é¢æ¥šæ­Œ"],
                comment: "å¤§è„‘å·²ç¦»çº¿ï¼Œç°åœ¨è¯´è¯çš„æ˜¯è„Šé«“åå°„ã€‚",
                emotion: "ğŸ˜µ"
            },
            {
                word: "è‡ªæ¥­è‡ªå¾—", reading: "ã˜ã”ã†ã˜ã¨ã (Jigoujitoku)", level: "N1",
                meaning: "è‡ªä½œè‡ªå—",
                scenario: "æ˜¨æ™šæ˜æ˜çŸ¥é“ä»Šå¤©è¦æ—©èµ·å´è¿˜æ˜¯ç†¬å¤œæ‰“æ¸¸æˆï¼Œç°åœ¨çš„å›°æ„å®Œå…¨æ˜¯______ã€‚",
                fullSentence: "æ˜¨æ™šæ˜æ˜çŸ¥é“ä»Šå¤©è¦æ—©èµ·å´è¿˜æ˜¯ç†¬å¤œæ‰“æ¸¸æˆï¼Œç°åœ¨çš„å›°æ„å®Œå…¨æ˜¯<span class='highlight-blank'>è‡ªæ¥­è‡ªå¾—</span>ã€‚",
                options: ["è‡ªæ¥­è‡ªå¾—", "ä¸€çŸ³äºŒé³¥", "è‡ªç”»è‡ªè³›", "åŠä¿¡åŠç–‘"],
                comment: "æœªæ¥çš„æˆ‘ä¸€å®šä¼šåŸè°…ç°åœ¨çš„æˆ‘çš„ï¼...å¹¶æ²¡æœ‰ã€‚",
                emotion: "ğŸ®"
            }
        ];

        // --- æ¸¸æˆçŠ¶æ€å˜é‡ ---
        let currentQuestionIndex = 0;
        let score = 0;
        let gameActive = false;
        let shuffledQuestions = [];

        // --- DOM å…ƒç´  ---
        const ui = {
            score: document.getElementById('scoreDisplay'),
            level: document.getElementById('levelDisplay'),
            progressBar: document.getElementById('progressBar'),
            face: document.getElementById('tanakaFace'),
            status: document.getElementById('statusText'),
            question: document.getElementById('questionText'),
            optionsGrid: document.getElementById('optionsGrid'),
            feedback: {
                panel: document.getElementById('feedbackPanel'),
                icon: document.getElementById('feedbackIcon'),
                title: document.getElementById('feedbackTitle'),
                word: document.getElementById('resultWord'),
                reading: document.getElementById('resultReading'),
                meaning: document.getElementById('resultMeaning'),
                comment: document.getElementById('funnyComment')
            },
            gameOver: {
                panel: document.getElementById('gameOverPanel'),
                finalScore: document.getElementById('finalScore'),
                rank: document.getElementById('finalRank'),
                shareBtn: document.getElementById('shareBtn')
            }
        };

        function initGame() {
            shuffledQuestions = [...vocabularyData].sort(() => 0.5 - Math.random());
            currentQuestionIndex = 0;
            score = 0;
            gameActive = true;
            updateScoreUI();
            
            ui.gameOver.panel.classList.add('hidden');
            ui.feedback.panel.classList.add('hidden');
            
            // æ£€æŸ¥åˆ†äº«åŠŸèƒ½
            if (navigator.share) {
                ui.gameOver.shareBtn.classList.remove('hidden');
            }
            
            loadQuestion();
        }

        function updateScoreUI() {
            ui.score.innerText = score;
            const progress = ((currentQuestionIndex) / shuffledQuestions.length) * 100;
            ui.progressBar.style.width = `${progress}%`;
        }

        function loadQuestion() {
            if (currentQuestionIndex >= shuffledQuestions.length) {
                endGame();
                return;
            }

            const q = shuffledQuestions[currentQuestionIndex];
            
            ui.level.innerText = q.level;
            ui.face.innerText = q.emotion;
            ui.status.innerText = `Q${currentQuestionIndex + 1}: ${q.level}`;
            
            const blank = "______";
            ui.question.innerHTML = q.scenario.replace(blank, `<span class='highlight-blank'>????</span>`);

            ui.optionsGrid.innerHTML = "";
            let currentOptions = [...q.options];
            currentOptions.sort(() => 0.5 - Math.random());

            currentOptions.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = "option-btn";
                btn.innerHTML = `<span>${opt}</span>`;
                btn.onclick = () => checkAnswer(opt, q);
                ui.optionsGrid.appendChild(btn);
            });
        }

        function checkAnswer(selectedOption, questionData) {
            if (!gameActive) return;

            const isCorrect = selectedOption === questionData.word;
            
            if (isCorrect) {
                score += 100;
                ui.face.innerText = "ğŸ˜";
                ui.status.innerText = "è¶…ç¥ï¼";
                showConfetti();
                showFeedback(true, questionData);
            } else {
                ui.face.innerText = "ğŸ˜­";
                ui.face.classList.add('shake');
                ui.status.innerText = "æç ¸äº†...";
                navigator.vibrate && navigator.vibrate(200); // æ‰‹æœºéœ‡åŠ¨åé¦ˆ
                setTimeout(() => ui.face.classList.remove('shake'), 500);
                showFeedback(false, questionData);
            }
            updateScoreUI();
        }

        function showFeedback(isCorrect, data) {
            gameActive = false;
            ui.feedback.icon.innerText = isCorrect ? "ğŸ‰" : "ğŸ¥€";
            ui.feedback.title.innerText = isCorrect ? "æ­£è§£ï¼" : "æ®‹å¿µï¼";
            ui.feedback.title.className = isCorrect ? "modal-title correct" : "modal-title wrong";
            
            ui.feedback.word.innerText = data.word;
            ui.feedback.reading.innerText = data.reading;
            ui.feedback.meaning.innerText = data.meaning;
            ui.feedback.comment.innerText = `"${data.comment}"`;
            ui.question.innerHTML = data.fullSentence;

            ui.feedback.panel.classList.remove('hidden');
            ui.feedback.panel.classList.add('pop-in');
        }

        function nextQuestion() {
            ui.feedback.panel.classList.add('hidden');
            ui.feedback.panel.classList.remove('pop-in');
            currentQuestionIndex++;
            gameActive = true;
            loadQuestion();
        }

        function endGame() {
            ui.progressBar.style.width = "100%";
            ui.gameOver.finalScore.innerText = score;
            
            let rankText = "";
            if (score === shuffledQuestions.length * 100) rankText = "æ—¥è¯­çš„ç¥ï¼(N0çº§åˆ«)";
            else if (score >= shuffledQuestions.length * 80) rankText = "ç²¾è‹±ç¤¾ç•œ (N1åˆæ ¼)";
            else if (score >= shuffledQuestions.length * 50) rankText = "æ™®é€šè·¯äºº (N3æ°´å¹³)";
            else rankText = "bakaç¡®ä¿¡ (åŠ æ²¹!)";
            
            ui.gameOver.rank.innerText = rankText;
            ui.gameOver.panel.classList.remove('hidden');
            ui.gameOver.panel.classList.add('pop-in');
            showConfetti();
        }

        function restartGame() {
            initGame();
        }

        function shareScore() {
            const text = `æˆ‘åœ¨ã€Šç”°ä¸­å›çš„å´©æºƒæ—¥å¸¸ã€‹ä¸­è·å¾—äº† ${score} åˆ†ï¼ç§°å·ï¼š${ui.gameOver.rank.innerText}ã€‚ä½ ä¹Ÿæ¥è¯•è¯•ï¼Ÿ`;
            if (navigator.share) {
                navigator.share({
                    title: 'ç”°ä¸­å›çš„å´©æºƒæ—¥å¸¸',
                    text: text,
                    url: window.location.href
                }).catch(console.error);
            } else {
                alert("å¤åˆ¶æˆåŠŸï¼š\n" + text);
            }
        }

        function showConfetti() {
            const canvas = document.getElementById('confetti');
            canvas.classList.remove('hidden');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            const particles = [];
            for(let i=0; i<60; i++) {
                particles.push({
                    x: canvas.width/2,
                    y: canvas.height/2,
                    vx: (Math.random() - 0.5) * 15,
                    vy: (Math.random() - 0.5) * 15 - 5,
                    color: `hsl(${Math.random()*360}, 100%, 50%)`,
                    size: Math.random() * 6 + 2,
                    life: 100
                });
            }

            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                let activeParticles = 0;
                particles.forEach(p => {
                    if(p.life > 0) {
                        p.x += p.vx;
                        p.y += p.vy;
                        p.vy += 0.3;
                        p.size *= 0.95;
                        p.life--;
                        
                        ctx.fillStyle = p.color;
                        ctx.beginPath();
                        ctx.arc(p.x, p.y, p.size, 0, Math.PI*2);
                        ctx.fill();
                        activeParticles++;
                    }
                });

                if (activeParticles > 0) {
                    requestAnimationFrame(animate);
                } else {
                    canvas.classList.add('hidden');
                }
            }
            animate();
        }

        initGame();
    </script>
</body>
</html>